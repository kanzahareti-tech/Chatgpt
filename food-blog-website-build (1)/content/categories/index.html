<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Categories - The Rustic Kitchen</title>
  <link rel="stylesheet" href="../../css/style.css" />
  <script>window.SITE_DATA = { recipes: [], categories: [] };</script>
  
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to content</a>
  <header class="site-header" role="banner" aria-label="Site header">
    <div class="container header-inner" style="display:flex;gap:12px;padding:12px 16px; justify-content:space-between;">
      <a href="../../index.html" class="logo">The Rustic Kitchen</a>
      <nav aria-label="Main navigation"><a href="../../index.html">Home</a> • <a href="../../recipes.html">Recipes</a></nav>
    </div>
  </header>
  <main id="main-content" class="container" style="padding:20px 16px; max-width:1100px;">
    <nav aria-label="Breadcrumbs" style="margin-bottom:12px; font-family:var(--font-body);">
      <span>Categories</span> › <span>All</span>
    </nav>
    <section class="layout" style="display:grid; grid-template-columns: 320px 1fr; gap:24px; align-items:start;">
      <!-- FILTERS -->
      <aside class="filters" aria-label="Filters" style="padding:16px; border:1px solid #eee; border-radius:12px; background:#fff;">
        <h3 style="font-family:var(--font-heading, 'Playfair Display', serif);">Filters</h3>
        <div class="filter-section" style="margin-top:8px;">
          <h4 style="margin:8px 0; font-size:1rem;">Categories</h4>
          <div id="filter-categories" class="filter-options" style="max-height:220px; overflow:auto; padding-right:6px;"></div>
        </div>
        <div class="filter-section" style="margin-top:12px;">
          <h4 style="margin:8px 0; font-size:1rem;">Cuisine</h4>
          <div id="filter-cuisines" class="filter-options" style="max-height:180px; overflow:auto;"></div>
        </div>
        <div class="filter-section" style="margin-top:12px;">
          <h4 style="margin:8px 0; font-size:1rem;">Dietary</h4>
          <div id="filter-diet" class="filter-options" style="max-height:150px; overflow:auto;"></div>
        </div>
        <div class="filter-section" style="margin-top:12px;">
          <h4 style="margin:8px 0; font-size:1rem;">Cooking Time</h4>
          <div id="filter-time" class="filter-options" style="max-height:150px; overflow:auto;"></div>
        </div>
        <div class="filter-section" style="margin-top:12px;">
          <h4 style="margin:8px 0; font-size:1rem;">Difficulty</h4>
          <div id="filter-difficulty" class="filter-options" style="max-height:120px; overflow:auto;"></div>
        </div>
        <div class="filters-actions" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
          <button id="clear-filters" class="btn" aria-label="Clear filters">Clear Filters</button>
          <button id="apply-filters" class="btn" aria-label="Apply filters" style="background:var(--color-accent);">Apply Filters</button>
        </div>
      </aside>

      <!-- RESULTS -->
      <section class="results" aria-label="Results" style="min-height:60vh;">
        <h2 style="font-family:var(--font-heading, 'Playfair Display', serif);">Categories</h2>
        <div id="categories-grid" class="grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:16px; margin:12px 0 6px;"></div>
        <hr style="border:none; height:1px; background:#eee; margin:18px 0;" />
        <h2 style="font-family:var(--font-heading, 'Playfair Display', serif);">Recipes</h2>
        <div id="recipes-grid" class="grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:16px; margin-top:8px;"></div>
        <div id="no-results" style="display:none; text-align:center; padding:16px; color:var(--color-dark-gray);">No results. Try adjusting filters.</div>
      </section>
    </section>
  </main>

  <script src="../../js/recipes.js"></script>
  <script src="../../js/main.js"></script>
  <script>
  // Dynamic categories page logic
  (function(){
    const data = window.SITE_DATA?.recipes || [];
    // derive main categories
    const categories = Array.from(new Set(data.map(r => (r.category || '').split(',')[0].trim()).filter(Boolean))).sort();
    const cuisines = Array.from(new Set(data.map(r => r.cuisine).filter(Boolean))).sort();
    const dietOptions = ['Vegetarian','Vegan','Gluten-Free','Dairy-Free','Keto','Low-Carb'];
    const timeBuckets = ['Under 15 mins','15-30 mins','30-60 mins','Over 1 hour'];

    function mkCheckbox(id,label){
      const wrap = document.createElement('div');
      wrap.style.display = 'flex'; wrap.style.alignItems = 'center'; wrap.style.gap = '6px'; wrap.style.marginBottom = '6px';
      wrap.innerHTML = `<input type="checkbox" id="${id}" value="${label}"><label for="${id}">${label}</label>`;
      return wrap;
    }

    // render filters
    const catWrap = document.getElementById('filter-categories');
    categories.forEach(c => catWrap?.appendChild(mkCheckbox('cat-'+c, c)));
    const cuiWrap = document.getElementById('filter-cuisines');
    cuisines.forEach(c => cuiWrap?.appendChild(mkCheckbox('cui-'+c, c)));
    const dietWrap = document.getElementById('filter-diet');
    dietOptions.forEach(d => dietWrap?.appendChild(mkCheckbox('diet-'+d, d)));
    const timeWrap = document.getElementById('filter-time');
    timeBuckets.forEach(t => timeWrap?.appendChild(mkCheckbox('time-'+t, t)));
    const diffWrap = document.getElementById('filter-difficulty');
    ['Easy','Medium','Hard'].forEach(d => diffWrap?.appendChild(mkCheckbox('diff-'+d, d)));

    // render category cards
    const categoriesGrid = document.getElementById('categories-grid');
    function renderCatCard(c){
      const count = data.filter(r => (r.category || '').split(',')[0].trim() === c).length;
      const slug = c.toLowerCase().replace(/[^a-z0-9]+/g,'-');
      const img = 'images/backgrounds/category-' + slug + '.svg';
      return `<article class="card" style="border-radius:12px; overflow:hidden; padding:0; display:flex; flex-direction:column; height:210px; width:180px; margin:0; justify-content:space-between; box-shadow:var(--shadow-card); background:#fff;">
        <div style="height:120px; background:url('${img}') center/cover no-repeat; border-bottom:1px solid #eee;"></div>
        <div style="padding:8px;">
          <div style="font-family:var(--font-heading, 'Playfair Display', serif); font-size:.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${c}</div>
          <div style="font-family:var(--font-body, 'Source Sans Pro', sans-serif); color:var(--color-dark-gray); font-size:.8rem;">${count} recipes</div>
        </div>
      </article>`;
    }
    categoriesGrid.innerHTML = categories.map(renderCatCard).join('');

    // render recipes grid (initial)
    const recipesGrid = document.getElementById('recipes-grid');
    function renderRecipeCard(r){
      const slug = (r.slug || r.title.toLowerCase().replace(/[^a-z0-9]+/g,'-'));
      const img = r.image || 'images/recipes/' + slug + '.svg';
      return `<article class="card" style="border-radius:12px; overflow:hidden; box-shadow:var(--shadow-card); background:white;">
        <a href="recipe-single.html?recipe=${slug}" style="display:block; height:180px; background:url('${img}') center/cover no-repeat;"></a>
        <div style="padding:12px;">
          <span class="badge" style="font-size:.75rem; background:#f1f1f1; padding:4px 8px; border-radius:999px;">${r.category}</span>
          <h3 style="font-family:var(--font-heading, 'Playfair Display', serif); font-size:1rem; margin:6px 0; height:2.2em; line-height:1.1; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">${r.title}</h3>
          <p style="font-family:var(--font-body, 'Source Sans Pro', sans-serif); color:var(--color-dark-gray); font-size:.9rem; margin:0; height:3em; overflow:hidden;">${r.description}</p>
        </div>
      </article>`;
    }
    function renderAllRecipes(results){ recipesGrid.innerHTML = results.map(renderRecipeCard).join(''); }
    renderAllRecipes(data);

    // filters logic
    function collectSelected(sel){ return Array.from(document.querySelectorAll(sel)).filter(cb => cb.checked).map(cb => cb.value); }
    function parseMinutes(text){ const m = /(\d+)\s*mins?/i.exec(text); if (m) return parseInt(m[1],10); const h = /(\d+)\s*hours?/i.exec(text); if (h) return parseInt(h[1],10)*60; return null; }
    function bucket(mins){ if (mins==null) return null; if (mins <=15) return 'Under 15 mins'; if (mins <=30) return '15-30 mins'; if (mins <=60) return '30-60 mins'; return 'Over 1 hour'; }
    function filterRecipes(){
      const catSel = collectSelected('#filter-categories input');
      const cuiSel = collectSelected('#filter-cuisines input');
      const dietSel = collectSelected('#filter-diet input');
      const timeSel = collectSelected('#filter-time input');
      const diffSel = collectSelected('#filter-difficulty input');
      const results = data.filter(r => {
        const mainCat = (r.category||'').split(',')[0].trim();
        if (catSel.length && !catSel.includes(mainCat)) return false;
        if (cuiSel.length && !(r.cuisine && cuiSel.includes(r.cuisine))) return false;
        const text = ((r.description||'') + ' ' + (r.ingredients||[]).join(' ')).toLowerCase();
        const dietOk = dietSel.every(d => {
          const dl = d.toLowerCase();
          return text.includes(dl) || (r.category||'').toLowerCase().includes(dl);
        });
        if (dietSel.length && !dietOk) return false;
        const mins = parseMinutes(r.time || ''); const b = bucket(mins);
        if (timeSel.length && !timeSel.includes(b)) return false;
        if (diffSel.length && !diffSel.includes(r.difficulty)) return false;
        return true;
      });
      renderAllRecipes(results);
      document.getElementById('no-results').style.display = results.length ? 'none' : 'block';
    }
    const applyBtn = document.getElementById('apply-filters');
    if (applyBtn) applyBtn.addEventListener('click', filterRecipes);
    const clearBtn = document.getElementById('clear-filters');
    if (clearBtn) clearBtn.addEventListener('click', ()=>{ document.querySelectorAll('#filter-categories input, #filter-cuisines input, #filter-diet input, #filter-time input, #filter-difficulty input').forEach(n=> n.checked=false); renderAllRecipes(data); document.getElementById('no-results').style.display='none'; });
  })();
  </script>
</body>
</html>
